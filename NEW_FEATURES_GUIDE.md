# 新功能使用指南

## 更新概览

本次更新为AI旅行规划师添加了以下重要功能：

### ✅ 已完成的改进

1. **首页优化** - 更紧凑的布局设计
2. **旅游偏好设置** - 个性化旅行规划
3. **费用记录模块** - 完整的费用管理系统
4. **智能推荐增强** - 具体的酒店餐厅推荐
5. **数据库扩展** - 新增用户偏好表

---

## 一、首页优化

### 改进内容
- 减少了各区域的padding，使页面更紧凑
- 优化了字体大小和间距
- 保持了美观的同时提高了信息密度

### 具体调整
- 英雄区域高度：600px → 450px
- 标题字体：3rem → 2.5rem
- 各section padding：6rem → 4rem

---

## 二、旅游偏好设置模块

### 功能说明
用户可以预先设置旅行偏好，系统在生成旅行计划时会自动考虑这些偏好。

### 偏好设置项

#### 1. **旅行风格**（多选）
- 休闲
- 探险
- 文化
- 美食
- 购物
- 自然

#### 2. **住宿偏好**（多选）
- 经济型
- 舒适型
- 豪华型
- 民宿
- 酒店
- 青旅

#### 3. **饮食偏好**（多选）
- 中餐
- 西餐
- 日韩料理
- 东南亚菜
- 素食
- 清真

#### 4. **交通偏好**（多选）
- 公共交通
- 出租车
- 租车
- 步行
- 自行车

#### 5. **活动偏好**（多选）
- 博物馆
- 景点
- 户外
- 购物
- 美食探店
- 夜生活

#### 6. **预算等级**（单选）
- 经济
- 中等
- 高端

#### 7. **行程节奏**（单选）
- 轻松
- 适中
- 紧凑

#### 8. **特殊需求**（文本）
- 例如：无障碍设施、带小孩、老人同行等

### 使用方法

1. 登录后点击导航栏的 **⚙️ 偏好设置** 按钮
2. 填写您的旅行偏好
3. 点击 **保存偏好** 按钮
4. 下次生成旅行计划时，系统会自动应用这些偏好

### 数据存储
- 偏好设置保存在Supabase数据库的 `user_preferences` 表中
- 每个用户只有一条偏好记录（更新时覆盖）
- 支持随时修改

---

## 三、费用记录模块

### 功能说明
完整的费用管理系统，帮助用户记录和追踪旅行支出。

### 主要功能

#### 1. **费用汇总**
- 总支出统计
- 记录数量
- 按类别分类统计

#### 2. **添加费用**
- 金额（精确到分）
- 类别（交通、住宿、餐饮、景点、购物、其他）
- 日期
- 描述

#### 3. **费用列表**
- 查看所有费用记录
- 显示类别、金额、描述、日期
- 支持删除操作

### 使用方法

1. 登录后点击导航栏的 **💰 费用记录** 按钮
2. 查看费用汇总和分类统计
3. 在"添加费用"区域填写费用信息
4. 点击 **添加** 按钮保存
5. 在费用列表中查看和管理所有记录

### 数据存储
- 费用记录保存在Supabase数据库的 `expenses` 表中
- 支持关联到具体的旅行计划（plan_id）
- 支持独立记录（不关联计划）

---

## 四、智能推荐增强

### 改进内容

#### 1. **结合用户偏好**
生成旅行计划时，系统会：
- 自动读取用户的偏好设置
- 将偏好信息传递给AI大模型
- 生成符合用户偏好的个性化计划

#### 2. **具体的酒店推荐**
每个住宿推荐包含：
- **酒店名称**：具体的酒店名字
- **地址**：详细地址
- **价格区间**：根据预算推荐合适档次
- **特色**：酒店的主要特点
- **评分**：参考评分
- **联系方式**：电话等（可选）

#### 3. **具体的餐厅推荐**
每个餐厅推荐包含：
- **餐厅名称**：具体的餐厅名字
- **菜系**：中餐、西餐等
- **招牌菜**：推荐菜品
- **人均消费**：价格参考
- **地址**：详细地址

#### 4. **增强的行程详情**
每个活动包含：
- 基本信息（时间、类型、名称）
- **详细信息**：
  - 具体地址
  - 价格区间
  - 评分
  - 特色亮点
  - 联系方式

### 示例输出结构

```json
{
  "destination": "北京",
  "duration": "3天",
  "budget": "5000元",
  "itinerary": [...],
  "accommodation_summary": [
    {
      "hotel_name": "北京王府井希尔顿酒店",
      "nights": 2,
      "total_cost": 1200,
      "address": "北京市东城区王府井大街8号",
      "features": ["地理位置优越", "设施完善", "服务优质"]
    }
  ],
  "restaurant_recommendations": [
    {
      "name": "全聚德烤鸭店（王府井店）",
      "cuisine": "北京菜",
      "signature_dishes": ["北京烤鸭", "芥末鸭掌"],
      "avg_cost": 150,
      "address": "北京市东城区前门大街30号"
    }
  ]
}
```

---

## 五、数据库更新

### 新增表：user_preferences

```sql
CREATE TABLE user_preferences (
    id SERIAL PRIMARY KEY,
    user_id UUID NOT NULL UNIQUE,
    travel_style TEXT[],
    accommodation_type TEXT[],
    food_preference TEXT[],
    transportation_preference TEXT[],
    activity_preference TEXT[],
    budget_level TEXT,
    pace TEXT,
    special_requirements TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### 更新说明
1. 在Supabase控制台执行 `database/schema.sql` 中的SQL语句
2. 确保RLS（行级安全）策略已启用
3. 用户只能访问自己的偏好数据

---

## 六、API接口

### 偏好设置API

#### 获取偏好
```
GET /api/preferences?user_id={user_id}
```

#### 保存偏好
```
POST /api/preferences
Body: {
  "user_id": "xxx",
  "preferences": {...}
}
```

### 费用记录API

#### 获取费用列表
```
GET /api/expenses?user_id={user_id}&plan_id={plan_id}
```

#### 添加费用
```
POST /api/expenses
Body: {
  "user_id": "xxx",
  "expense": {...}
}
```

#### 更新费用
```
PUT /api/expenses/{expense_id}
Body: {
  "user_id": "xxx",
  "expense": {...}
}
```

#### 删除费用
```
DELETE /api/expenses/{expense_id}?user_id={user_id}
```

#### 获取费用汇总
```
GET /api/expenses/summary?user_id={user_id}&plan_id={plan_id}
```

---

## 七、使用流程

### 完整使用流程

1. **首次使用**
   - 访问 `http://localhost:8080`
   - 注册/登录账号
   - 进入主应用

2. **设置偏好**
   - 点击 **⚙️ 偏好设置**
   - 填写旅行偏好
   - 保存设置

3. **生成旅行计划**
   - 输入旅行需求（文字或语音）
   - 系统自动结合偏好生成计划
   - 查看具体的酒店和餐厅推荐

4. **记录费用**
   - 点击 **💰 费用记录**
   - 添加实际支出
   - 查看费用统计

---

## 八、技术栈

### 后端
- **Flask** - Web框架
- **Supabase** - 数据库和认证
- **DeepSeek (火山方舟)** - AI大模型
- **Python服务**：
  - `preference_service.py` - 偏好设置服务
  - `expense_service.py` - 费用记录服务

### 前端
- **HTML5** - 结构
- **CSS3** - 样式（新增300+行样式）
- **JavaScript (ES6+)** - 交互逻辑（新增270+行代码）

### 数据库
- **PostgreSQL (Supabase)** - 主数据库
- **新增表**：`user_preferences`
- **已有表**：`travel_plans`, `expenses`

---

## 九、注意事项

### 1. 数据库配置
- 确保Supabase已正确配置
- 执行 `database/schema.sql` 创建新表
- 检查RLS策略是否启用

### 2. 端口配置
- 默认端口：8080
- 如需修改，更新 `app.py` 中的端口设置

### 3. 用户认证
- 所有功能需要登录后使用
- 用户数据完全隔离
- 支持退出登录

### 4. AI生成质量
- 偏好设置越详细，推荐越精准
- 预算信息会影响酒店餐厅档次
- 特殊需求会被AI考虑

---

## 十、常见问题

### Q1: 偏好设置不生效？
**A:** 确保：
1. 偏好已成功保存（有成功提示）
2. 重新生成旅行计划（不是查看旧计划）
3. Supabase连接正常

### Q2: 费用记录无法添加？
**A:** 检查：
1. 是否已登录
2. Supabase配置是否正确
3. 日期格式是否正确

### Q3: 酒店餐厅推荐不够具体？
**A:** 这取决于AI模型的输出，建议：
1. 在输入中明确要求具体推荐
2. 设置详细的偏好信息
3. 提供更具体的预算和地点

### Q4: 如何清除偏好设置？
**A:** 
1. 打开偏好设置
2. 取消所有选择
3. 保存即可

---

## 十一、未来优化建议

1. **偏好模板** - 提供常用偏好模板
2. **费用预算对比** - 计划预算vs实际支出
3. **费用导出** - 导出Excel或PDF
4. **智能提醒** - 超支提醒
5. **多人协作** - 共享旅行计划和费用
6. **图表统计** - 可视化费用分析
7. **历史对比** - 多次旅行费用对比

---

## 十二、更新日志

### 2025-11-11
- ✅ 优化首页布局，更紧凑的设计
- ✅ 新增旅游偏好设置模块
- ✅ 新增费用记录模块
- ✅ 增强AI推荐，提供具体酒店餐厅
- ✅ 数据库新增user_preferences表
- ✅ 新增6个API接口
- ✅ 前端新增270+行JavaScript代码
- ✅ 前端新增300+行CSS样式

---

## 联系支持

如有问题或建议，请查看：
- `README.md` - 项目说明
- `FRONTEND_REDESIGN.md` - 前端重构文档
- `database/schema.sql` - 数据库结构

祝您使用愉快！🎉

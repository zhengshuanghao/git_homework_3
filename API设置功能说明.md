# API设置功能使用说明

## 功能概述

新增了"API设置"功能，允许用户在登录后通过界面直接配置所有API密钥，无需手动创建或编辑`.env`文件。

## 使用步骤

### 1. 登录应用

首先注册并登录到应用。

### 2. 打开API设置

点击导航栏的 **"🔧 API设置"** 按钮。

### 3. 填写API密钥

在弹出的设置窗口中，填写您需要配置的API密钥：

#### 🎤 火山方舟语音识别
- **APP ID**：语音识别应用ID
- **Access Key**：访问密钥
- **Secret Key**：安全密钥
- **Model ID**：模型ID

#### 🗺️ 高德地图API
- **API Key**：高德地图密钥（必需）
- **API Secret**：高德地图安全密钥（可选）

#### 🤖 火山方舟 DeepSeek LLM
- **API Key**：火山方舟API密钥
- **Base URL**：API基础URL（默认已填写）
- **Model/Endpoint ID**：模型端点ID

#### 🗄️ Supabase数据库
- **Supabase URL**：数据库URL
- **Supabase Key**：数据库密钥（Anon Key）

#### 🔐 Flask配置
- **Secret Key**：Flask会话加密密钥

### 4. 保存配置

点击 **"💾 保存配置"** 按钮。

### 5. 配置生效

- 配置会自动保存到`.env`文件
- 应用会自动重新加载配置
- **无需重启应用**即可生效

## 功能特点

### ✅ 优点

1. **无需手动编辑文件**
   - 不需要创建或编辑`.env`文件
   - 界面友好，降低使用门槛

2. **配置状态显示**
   - 已配置的项目会显示"已配置 ✓"
   - 未配置的项目显示示例格式

3. **部分更新支持**
   - 可以只填写需要更新的配置项
   - 其他配置保持不变

4. **即时生效**
   - 保存后自动重新加载配置
   - 无需重启应用

5. **安全性**
   - 密码字段使用密码输入框
   - 不会在界面上显示实际密钥值

### 🔒 安全说明

- 配置保存在服务器的`.env`文件中
- 建议在生产环境使用更安全的密钥管理方案
- 定期更换API密钥

## 配置项说明

### 必需配置

以下配置是应用正常运行所必需的：

- **Supabase URL & Key**：用户数据存储
- **ARK API Key & DeepSeek Model**：AI旅行计划生成

### 可选配置

以下配置为可选，不配置会影响部分功能：

- **语音识别配置**：不配置则无法使用语音输入功能
- **高德地图配置**：不配置则无法显示地图

### 推荐配置

建议配置所有API密钥以获得完整功能体验。

## 常见问题

### Q1: 配置保存后没有生效？

**A:** 
- 检查是否有错误提示
- 确认填写的密钥格式正确
- 尝试刷新页面

### Q2: 如何查看当前配置？

**A:** 
- 打开API设置窗口
- 已配置的项目会显示"已配置 ✓"
- 出于安全考虑，不会显示实际密钥值

### Q3: 可以只更新部分配置吗？

**A:** 
- 可以！只填写需要更新的字段
- 留空的字段会保持原有配置不变

### Q4: 配置保存在哪里？

**A:** 
- 配置保存在项目根目录的`.env`文件中
- 可以手动编辑该文件
- 建议通过界面配置更安全方便

### Q5: 忘记了之前配置的密钥怎么办？

**A:** 
- 界面不会显示实际密钥值
- 需要从API服务商处重新获取
- 或者查看`.env`文件

## 获取API密钥

### 火山方舟语音识别
访问：https://console.volcengine.com/speech/service

### 高德地图
访问：https://console.amap.com/dev/key/app

### 火山方舟 DeepSeek
访问：https://console.volcengine.com/ark

### Supabase
访问：https://supabase.com/dashboard/project/_/settings/api

## 技术实现

### 前端
- 模态框表单收集配置
- AJAX提交到后端API
- 显示配置状态

### 后端
- 接收配置数据
- 验证并写入`.env`文件
- 重新加载配置
- 重新初始化服务

### API接口
- `POST /api/config/save`：保存配置
- `GET /api/config/all`：获取配置状态

## 更新日志

### v1.0 (2025-11-11)
- ✅ 新增API设置界面
- ✅ 支持所有API密钥配置
- ✅ 自动保存到.env文件
- ✅ 即时生效无需重启
- ✅ 配置状态显示

---

**提示**：建议在首次使用应用时立即配置API密钥，以获得完整功能体验。

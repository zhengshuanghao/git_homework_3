# 修复"麦克风被其他应用占用"问题

## 问题描述

错误信息：`麦克风被其他应用占用。请关闭其他使用麦克风的应用后重试。`

这个错误通常表示浏览器无法读取麦克风，可能的原因包括：

## 可能的原因和解决方案

### 1. 浏览器其他标签页占用麦克风

**解决方法：**
- 关闭浏览器中所有其他标签页
- 只保留当前应用的标签页
- 刷新页面后重试

### 2. 其他应用占用麦克风

**检查以下应用：**
- Zoom
- Microsoft Teams
- Skype
- Discord
- 微信/QQ 视频通话
- 系统录音应用
- 其他视频会议软件

**解决方法：**
- 完全关闭这些应用（不只是最小化）
- 在任务管理器中检查是否有相关进程
- 重启电脑（如果问题持续）

### 3. 系统权限问题

**Windows 10/11：**
1. 打开"设置" → "隐私" → "麦克风"
2. 确保"允许应用访问你的麦克风"已开启
3. 确保"允许桌面应用访问你的麦克风"已开启
4. 检查浏览器是否在允许列表中

**解决方法：**
- 重新设置麦克风权限
- 重启浏览器
- 如果问题持续，重启电脑

### 4. 浏览器权限问题

**Chrome/Edge：**
1. 点击地址栏左侧的锁图标
2. 找到"麦克风"权限
3. 设置为"允许"
4. 如果已经是"允许"，先设置为"阻止"，再改回"允许"
5. 刷新页面

**Firefox：**
1. 点击地址栏左侧的锁图标
2. 点击"权限" → "使用麦克风"
3. 设置为"允许"
4. 刷新页面

### 5. 麦克风驱动程序问题

**解决方法：**
1. 打开"设备管理器"
2. 找到"音频输入和输出"
3. 检查麦克风设备是否有黄色感叹号
4. 如果有，更新驱动程序
5. 重启电脑

### 6. 麦克风硬件问题

**检查：**
1. 麦克风是否已正确连接
2. 麦克风是否在其他应用中正常工作
3. 尝试使用系统录音应用测试麦克风

**解决方法：**
- 拔插麦克风设备
- 尝试使用其他麦克风设备
- 检查麦克风音量设置

## 使用诊断工具

### 方法 1: 使用页面诊断按钮

1. 访问应用页面
2. 点击右下角的"🔍 麦克风诊断"按钮
3. 查看诊断结果
4. 根据提示解决问题

### 方法 2: 使用浏览器控制台

1. 按 F12 打开开发者工具
2. 切换到 Console 标签
3. 运行以下命令：

```javascript
diagnoseMicrophone().then(results => {
    console.log('诊断结果:', results);
    if (results.errors.length > 0) {
        console.error('错误:', results.errors);
    }
});
```

## 快速检查清单

- [ ] 关闭所有其他使用麦克风的应用
- [ ] 关闭浏览器中其他标签页
- [ ] 检查浏览器麦克风权限（地址栏锁图标）
- [ ] 检查系统麦克风权限（Windows 设置）
- [ ] 使用 `http://localhost:8080` 访问（不要使用 IP 地址）
- [ ] 重启浏览器
- [ ] 检查麦克风是否在其他应用中正常工作
- [ ] 尝试使用其他浏览器
- [ ] 如果问题持续，重启电脑

## 测试麦克风

在浏览器控制台运行以下代码测试麦克风：

```javascript
navigator.mediaDevices.getUserMedia({ audio: true })
  .then(stream => {
    console.log('✅ 麦克风访问成功');
    console.log('音频轨道:', stream.getAudioTracks());
    stream.getTracks().forEach(track => {
      console.log('轨道信息:', track.getSettings());
      track.stop();
    });
  })
  .catch(err => {
    console.error('❌ 错误:', err.name, err.message);
    
    if (err.name === 'NotReadableError') {
      console.error('可能的原因:');
      console.error('1. 麦克风被其他应用占用');
      console.error('2. 浏览器其他标签页在使用麦克风');
      console.error('3. 系统权限问题');
      console.error('4. 驱动程序问题');
    }
  });
```

## 如果问题仍然存在

1. **尝试不同的浏览器**
   - Chrome
   - Firefox
   - Edge

2. **检查系统日志**
   - Windows 事件查看器
   - 检查是否有音频相关的错误

3. **更新驱动程序**
   - 访问设备制造商网站
   - 下载最新驱动程序

4. **联系支持**
   - 提供浏览器类型和版本
   - 提供操作系统信息
   - 提供诊断工具的输出结果
   - 提供控制台错误信息

## 常见错误代码

| 错误名称 | 含义 | 解决方法 |
|---------|------|---------|
| NotReadableError | 无法读取麦克风 | 关闭其他应用，检查权限 |
| NotAllowedError | 权限被拒绝 | 在浏览器设置中允许麦克风 |
| NotFoundError | 未找到设备 | 检查麦克风是否连接 |
| SecurityError | 安全错误 | 使用 localhost 或 HTTPS |

## 预防措施

1. 使用应用前，先关闭其他可能使用麦克风的应用
2. 使用 `localhost` 而不是 IP 地址访问
3. 定期检查浏览器和系统权限设置
4. 保持浏览器和系统更新


# 🎓 给助教的Docker镜像使用说明

## 📦 项目信息

- **项目名称**：AI旅行规划师
- **GitHub仓库**：https://github.com/zhengshuanghao/git_homework_3
- **Docker镜像地址**：`registry.cn-hangzhou.aliyuncs.com/ai_travel_planner_zsh/ai_travel_planner_zsh_522025720032`
- **最新版本**：v1.0.0

---

## 🚀 快速开始（3步启动）

### 方式一：使用Docker命令（最简单）

```bash
# 1. 拉取镜像
docker pull registry.cn-hangzhou.aliyuncs.com/ai_travel_planner_zsh/ai_travel_planner_zsh_522025720032:latest

# 2. 运行容器（请替换为实际的API密钥）
docker run -d \
  --name ai-travel-planner \
  -p 8080:8080 \
  -e ARK_API_KEY=你的火山方舟API密钥 \
  -e DEEPSEEK_MODEL=你的模型端点ID \
  -e SUPABASE_URL=https://hfhxiwcuikcmtpcyyevl.supabase.co \
  -e SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhmaHhpd2N1aWtjbXRwY3l5ZXZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1MzczNDksImV4cCI6MjA3ODExMzM0OX0.u9xX7WOMuYq4fBwJI313vc14OfOuSgabylXqUWFSwTQ \
  registry.cn-hangzhou.aliyuncs.com/ai_travel_planner_zsh/ai_travel_planner_zsh_522025720032:latest

# 3. 访问应用
# 打开浏览器访问 http://localhost:8080
```

### 方式二：使用docker-compose（推荐）

1. **下载配置文件**

从GitHub仓库下载以下文件：
- `docker-compose.yml`
- `.env.example`

2. **配置环境变量**

```bash
# 复制示例文件
cp .env.example .env

# 编辑.env文件，填入API密钥
# 可以使用记事本或任何文本编辑器
```

3. **启动服务**

```bash
docker-compose up -d
```

4. **访问应用**

打开浏览器访问：http://localhost:8080

---

## 🔑 必需的API密钥

### 最小配置（必需）

以下是应用运行的最小配置：

```env
# 火山方舟 DeepSeek API（必需）
ARK_API_KEY=你的API密钥
DEEPSEEK_MODEL=你的模型端点ID

# Supabase数据库（必需）
SUPABASE_URL=https://hfhxiwcuikcmtpcyyevl.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### 完整配置（可选功能）

如需使用所有功能，请配置：

```env
# 火山方舟语音识别（语音输入功能）
SPEECH_APP_ID=1356755714
SPEECH_ACCESS_KEY=oPxND_k8BQJveNLg7Mdq9VXRvKgFnIlP
SPEECH_SECRET_KEY=Aj8WnzaLDOeWTiIcF9zC-7dN2QPypq6h
SPEECH_MODEL_ID=Speech_Recognition_Seed_streaming2000000451913596898

# 高德地图（地图显示功能）
AMAP_API_KEY=62b0a02ed7213d7753d65007051c0c6f
```

---

## 📋 可用的镜像标签

| 标签 | 说明 | 拉取命令 |
|------|------|---------|
| `latest` | 最新版本 | `docker pull registry.cn-hangzhou.aliyuncs.com/ai_travel_planner_zsh/ai_travel_planner_zsh_522025720032:latest` |
| `v1.0.0` | 稳定版本1.0.0 | `docker pull registry.cn-hangzhou.aliyuncs.com/ai_travel_planner_zsh/ai_travel_planner_zsh_522025720032:v1.0.0` |
| `main` | 主分支最新构建 | `docker pull registry.cn-hangzhou.aliyuncs.com/ai_travel_planner_zsh/ai_travel_planner_zsh_522025720032:main` |

---

## 🎯 核心功能演示

### 1. 注册/登录
- 访问 http://localhost:8080
- 点击"注册"创建账号
- 使用邮箱和密码登录

### 2. API设置（可选）
- 登录后点击"🔧 API设置"
- 在界面中配置其他API密钥
- 无需重启容器即可生效

### 3. 设置旅游偏好
- 点击"⚙️ 偏好设置"
- 选择旅行风格、住宿类型等
- 保存后AI会根据偏好生成计划

### 4. 生成旅行计划
- **文字输入**：输入"我想去北京3天，预算5000元"
- **语音输入**：点击麦克风说出需求（需配置语音识别）
- 点击"生成旅行计划"
- 查看详细行程、地图、酒店餐厅推荐

### 5. 记录费用
- 点击"💰 费用记录"
- 添加旅行开销
- 可关联具体旅行计划
- 查看费用统计

---

## 🔍 验证部署成功

### 检查容器状态

```bash
# 查看运行中的容器
docker ps

# 应该看到类似输出：
# CONTAINER ID   IMAGE                                                                      STATUS         PORTS
# abc123def456   registry.cn-hangzhou.aliyuncs.com/ai_travel_planner_zsh/ai_travel_planner_zsh_522025720032:latest   Up 2 minutes   0.0.0.0:8080->8080/tcp
```

### 查看容器日志

```bash
docker logs ai-travel-planner

# 应该看到类似输出：
# ============================================================
# AI旅行规划师 - 火山方舟流式语音识别版
# ============================================================
# 服务器地址: http://localhost:8080
# ...
```

### 健康检查

```bash
# 检查容器健康状态
docker inspect --format='{{.State.Health.Status}}' ai-travel-planner

# 应该输出：healthy
```

---

## 🛠️ 常用管理命令

```bash
# 查看日志（实时）
docker logs -f ai-travel-planner

# 查看日志（最后100行）
docker logs --tail 100 ai-travel-planner

# 停止容器
docker stop ai-travel-planner

# 启动容器
docker start ai-travel-planner

# 重启容器
docker restart ai-travel-planner

# 删除容器
docker rm -f ai-travel-planner

# 进入容器调试
docker exec -it ai-travel-planner /bin/bash

# 查看容器资源使用
docker stats ai-travel-planner
```

---

## 🐛 常见问题排查

### 问题1：端口被占用

**错误信息**：`bind: address already in use`

**解决方案**：
```bash
# 方式A：使用其他端口
docker run -d -p 8081:8080 ...

# 方式B：停止占用8080端口的程序
# Windows
netstat -ano | findstr :8080
taskkill /F /PID <进程ID>
```

### 问题2：容器启动失败

**解决方案**：
```bash
# 查看详细错误日志
docker logs ai-travel-planner --tail 50

# 检查环境变量是否正确
docker exec ai-travel-planner env | grep -E "ARK|SUPABASE"
```

### 问题3：无法访问应用

**检查清单**：
- [ ] 容器是否在运行：`docker ps`
- [ ] 端口映射是否正确：`docker port ai-travel-planner`
- [ ] 防火墙是否阻止：临时关闭防火墙测试
- [ ] 浏览器访问：http://localhost:8080 或 http://127.0.0.1:8080

### 问题4：功能不正常

**可能原因**：
1. API密钥未配置或错误
2. 网络连接问题
3. API服务异常

**解决方案**：
- 检查日志中的错误信息
- 在应用的"API设置"中重新配置密钥
- 确认API服务可用

---

## 📊 性能要求

### 最低配置
- CPU：1核
- 内存：512MB
- 磁盘：2GB

### 推荐配置
- CPU：2核
- 内存：2GB
- 磁盘：5GB

---

## 🔗 相关资源

### 文档
- [完整部署指南](DOCKER_DEPLOYMENT.md)
- [GitHub Actions配置](GITHUB_ACTIONS_SETUP.md)
- [项目README](README.md)
- [Docker快速开始](QUICK_START_DOCKER.md)

### 链接
- **GitHub仓库**：https://github.com/zhengshuanghao/git_homework_3
- **Docker镜像**：registry.cn-hangzhou.aliyuncs.com/ai_travel_planner_zsh/ai_travel_planner_zsh_522025720032
- **在线演示**：http://localhost:8080（本地部署后）

---

## 📝 评分要点说明

### ✅ 已实现的功能

1. **Docker化部署**
   - ✅ 完整的Dockerfile
   - ✅ 优化的.dockerignore
   - ✅ docker-compose支持
   - ✅ 多平台支持（amd64/arm64）

2. **CI/CD自动化**
   - ✅ GitHub Actions自动构建
   - ✅ 自动推送到阿里云镜像仓库
   - ✅ 多标签支持（latest/版本号/分支名）
   - ✅ 构建缓存优化

3. **易用性**
   - ✅ 一键启动
   - ✅ 环境变量配置
   - ✅ 健康检查
   - ✅ 详细文档

4. **完整功能**
   - ✅ AI旅行规划
   - ✅ 语音识别
   - ✅ 地图展示
   - ✅ 偏好设置
   - ✅ 费用管理
   - ✅ 用户系统

---

## 💡 使用建议

1. **首次使用**
   - 建议使用`latest`标签
   - 先配置最小必需的API密钥
   - 测试基本功能后再配置完整功能

2. **生产使用**
   - 使用具体版本标签（如`v1.0.0`）
   - 配置所有API密钥
   - 定期备份Supabase数据

3. **问题反馈**
   - 查看容器日志
   - 检查GitHub Issues
   - 联系开发者

---

## 🎉 快速验证清单

- [ ] Docker镜像拉取成功
- [ ] 容器启动成功
- [ ] 浏览器可以访问 http://localhost:8080
- [ ] 可以注册/登录账号
- [ ] 可以生成旅行计划
- [ ] 地图正常显示
- [ ] 可以保存偏好设置
- [ ] 可以记录费用

---

**祝评测顺利！如有任何问题，请查看详细文档或联系开发者。** 🚀

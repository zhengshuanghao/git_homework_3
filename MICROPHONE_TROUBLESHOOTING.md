# 麦克风访问问题排查指南

## 常见问题

### 1. 浏览器提示"无法访问麦克风"

#### 原因分析
- 浏览器安全策略要求 HTTPS（除了 localhost）
- 麦克风权限未正确授予
- 麦克风被其他应用占用
- 浏览器不支持相关 API

#### 解决方案

**步骤 1: 检查浏览器权限**

1. **Chrome/Edge**:
   - 点击地址栏左侧的锁图标或信息图标
   - 找到"麦克风"权限
   - 设置为"允许"
   - 刷新页面

2. **Firefox**:
   - 点击地址栏左侧的锁图标
   - 点击"权限" → "使用麦克风"
   - 设置为"允许"
   - 刷新页面

3. **Safari**:
   - Safari → 偏好设置 → 网站 → 麦克风
   - 找到你的网站，设置为"允许"

**步骤 2: 检查 URL**

确保使用以下地址之一：
- `http://localhost:8080` ✅
- `http://127.0.0.1:8080` ✅
- `https://yourdomain.com` ✅

❌ 不要使用：
- `http://10.36.10.87:8080`（非 localhost 的 HTTP 地址）

**步骤 3: 检查麦克风设备**

1. 确认麦克风已连接
2. 检查系统设置中的麦克风权限
3. 关闭其他使用麦克风的应用（如 Zoom、Teams 等）

**步骤 4: 检查浏览器控制台**

按 F12 打开开发者工具，查看 Console 标签中的错误信息。

## 浏览器兼容性

### 支持的浏览器

| 浏览器 | 最低版本 | 说明 |
|--------|---------|------|
| Chrome | 60+ | ✅ 完全支持 |
| Edge | 79+ | ✅ 完全支持 |
| Firefox | 55+ | ✅ 完全支持 |
| Safari | 11+ | ⚠️ 部分支持 |
| Opera | 47+ | ✅ 完全支持 |

### 不支持的浏览器

- Internet Explorer（所有版本）
- 旧版移动浏览器

## 安全上下文要求

现代浏览器要求麦克风访问必须在"安全上下文"中：

### 安全上下文包括：
- ✅ `https://` 协议
- ✅ `http://localhost`
- ✅ `http://127.0.0.1`
- ✅ `http://*.localhost`

### 非安全上下文：
- ❌ `http://192.168.x.x`
- ❌ `http://10.x.x.x`
- ❌ `http://其他IP地址`

## 解决方案

### 方案 1: 使用 localhost（推荐）

访问应用时使用：
```
http://localhost:8080
```

而不是：
```
http://10.36.10.87:8080
```

### 方案 2: 配置 HTTPS（生产环境）

如果需要通过 IP 地址访问，需要配置 HTTPS：

1. 生成 SSL 证书
2. 配置 Flask 使用 HTTPS
3. 使用 `https://your-ip:8080` 访问

### 方案 3: 使用反向代理

使用 Nginx 或 Apache 配置 HTTPS 反向代理。

## 测试麦克风访问

在浏览器控制台（F12）中运行以下代码测试：

```javascript
navigator.mediaDevices.getUserMedia({ audio: true })
  .then(stream => {
    console.log('✅ 麦克风访问成功');
    stream.getTracks().forEach(track => track.stop());
  })
  .catch(err => {
    console.error('❌ 麦克风访问失败:', err.name, err.message);
  });
```

## 常见错误代码

| 错误名称 | 原因 | 解决方案 |
|---------|------|---------|
| `NotAllowedError` | 用户拒绝了权限 | 在浏览器设置中允许麦克风权限 |
| `NotFoundError` | 未找到麦克风设备 | 检查麦克风是否连接 |
| `NotReadableError` | 麦克风被占用 | 关闭其他使用麦克风的应用 |
| `OverconstrainedError` | 不支持的配置 | 使用默认配置 |
| `SecurityError` | 非安全上下文 | 使用 HTTPS 或 localhost |

## 调试步骤

1. **检查浏览器控制台**
   - 按 F12 打开开发者工具
   - 查看 Console 中的错误信息

2. **检查权限设置**
   - 地址栏 → 锁图标 → 权限设置

3. **测试麦克风**
   - 使用系统录音应用测试麦克风是否正常

4. **检查其他应用**
   - 关闭所有可能使用麦克风的应用

5. **重启浏览器**
   - 有时需要完全关闭浏览器后重新打开

## 如果问题仍然存在

1. 尝试使用不同的浏览器
2. 检查系统防火墙设置
3. 更新浏览器到最新版本
4. 检查是否有浏览器扩展阻止了麦克风访问

## 联系支持

如果以上方法都无法解决问题，请提供：
- 浏览器类型和版本
- 操作系统
- 控制台错误信息
- 访问的 URL


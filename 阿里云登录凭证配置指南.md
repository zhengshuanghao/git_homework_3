# 阿里云容器镜像服务登录凭证配置指南

## 问题诊断

当前错误：`403 Forbidden` 表示认证失败，需要重新配置正确的访问凭证。

---

## 🔑 获取正确的访问凭证

### 步骤1：访问阿里云控制台

1. 打开浏览器，访问：https://cr.console.aliyun.com/
2. 登录您的阿里云账号

### 步骤2：进入访问凭证页面

- 方式A：点击左侧菜单 **"访问凭证"**
- 方式B：点击右上角头像 → **"访问凭证"**

### 步骤3：设置固定密码

1. 在 **"固定密码"** 标签页
2. 如果从未设置过，点击 **"设置固定密码"**
3. 如果已设置过，点击 **"重置Docker登录密码"**
4. 输入新密码（建议使用强密码，包含大小写字母、数字、特殊字符）
5. 确认并保存

### 步骤4：获取用户名

在同一页面，您会看到类似这样的示例命令：

```bash
docker login --username=<这里是您的用户名> registry.cn-hangzhou.aliyuncs.com
```

**重要提示**：
- 用户名通常是一串数字ID（如：`1234567890123456`）
- 或者是您的阿里云账号邮箱/手机号
- **请从控制台直接复制，不要手动输入**

---

## 🧪 本地测试（重要！）

在更新GitHub Secrets之前，先在本地测试凭证是否正确：

### 测试命令

```powershell
# 替换<用户名>和<密码>为您实际的凭证
docker login --username=<用户名> --password=<密码> registry.cn-hangzhou.aliyuncs.com
```

### 预期结果

**成功**：
```
Login Succeeded
```

**失败**：
```
Error response from daemon: Get "https://registry.cn-hangzhou.aliyuncs.com/v2/": unauthorized
```

---

## 📝 更新GitHub Secrets

### 只有在本地测试成功后，才执行此步骤！

1. **访问GitHub仓库**
   ```
   https://github.com/zhengshuanghao/git_homework_3/settings/secrets/actions
   ```

2. **更新ALIYUN_REGISTRY_USERNAME**
   - 点击 `ALIYUN_REGISTRY_USERNAME` 旁边的 "Update"
   - 粘贴您从阿里云控制台复制的用户名
   - 点击 "Update secret"

3. **更新ALIYUN_REGISTRY_PASSWORD**
   - 点击 `ALIYUN_REGISTRY_PASSWORD` 旁边的 "Update"
   - 粘贴您刚才设置的固定密码
   - 点击 "Update secret"

---

## 🔄 重新触发构建

### 方式A：手动触发（推荐）

1. 访问：https://github.com/zhengshuanghao/git_homework_3/actions
2. 点击左侧 **"Build and Push Docker Image to Aliyun"**
3. 点击右侧 **"Run workflow"** 下拉按钮
4. 选择 `main` 分支
5. 点击绿色的 **"Run workflow"** 按钮

### 方式B：推送空提交

```bash
git commit --allow-empty -m "Trigger rebuild with updated credentials"
git push origin main
```

---

## ❓ 常见问题

### Q1: 用户名格式是什么？

**A**: 通常是以下格式之一：
- 纯数字ID：`1234567890123456`
- 邮箱：`your_email@example.com`
- 手机号：`13800138000`

**请从阿里云控制台的"访问凭证"页面直接复制！**

### Q2: 密码是什么？

**A**: 
- **不是**阿里云账号密码
- **不是**AccessKey Secret
- **是**在容器镜像服务中设置的"固定密码"

### Q3: 如何确认用户名正确？

**A**: 在阿里云控制台的"访问凭证"页面，会显示完整的登录命令，例如：
```bash
docker login --username=1234567890123456 registry.cn-hangzhou.aliyuncs.com
```
其中 `1234567890123456` 就是您的用户名。

### Q4: 本地测试成功，但GitHub Actions还是失败？

**A**: 
1. 确认GitHub Secrets中的值与本地测试使用的完全一致
2. 注意不要有多余的空格或换行
3. 等待1-2分钟让Secrets生效后再触发构建

---

## ✅ 检查清单

在触发GitHub Actions构建之前，请确认：

- [ ] 已在阿里云设置/重置了固定密码
- [ ] 已从阿里云控制台复制了正确的用户名
- [ ] 已在本地成功测试 `docker login`
- [ ] 已更新GitHub Secrets中的两个值
- [ ] 确认Secrets中没有多余的空格或特殊字符

---

## 🎯 下一步

1. **立即行动**：访问阿里云控制台设置固定密码
2. **本地测试**：使用 `docker login` 命令验证
3. **更新Secrets**：在GitHub仓库中更新凭证
4. **重新构建**：手动触发GitHub Actions

**重要**：只有本地测试成功后，才更新GitHub Secrets！

---

生成时间：2025-11-11

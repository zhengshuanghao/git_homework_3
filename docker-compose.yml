version: '3.8'

services:
  ai-travel-planner:
    image: crpi-t07boaz31v5le95c.cn-hangzhou.personal.cr.aliyuncs.com/ai_travel_planner_zsh/ai_travel_planner_zsh_522025720032:latest
    container_name: ai-travel-planner
    ports:
      - "8080:8080"
    environment:
      # 火山方舟语音识别
      - SPEECH_APP_ID=${SPEECH_APP_ID}
      - SPEECH_ACCESS_KEY=${SPEECH_ACCESS_KEY}
      - SPEECH_SECRET_KEY=${SPEECH_SECRET_KEY}
      - SPEECH_MODEL_ID=${SPEECH_MODEL_ID}
      
      # 高德地图
      - AMAP_API_KEY=${AMAP_API_KEY}
      - AMAP_API_SECRET=${AMAP_API_SECRET}
      
      # 火山方舟 DeepSeek
      - ARK_API_KEY=${ARK_API_KEY}
      - ARK_BASE_URL=${ARK_BASE_URL:-https://ark.cn-beijing.volces.com/api/v3}
      - DEEPSEEK_MODEL=${DEEPSEEK_MODEL}
      
      # Supabase
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_KEY=${SUPABASE_KEY}
      
      # Flask
      - FLASK_SECRET_KEY=${FLASK_SECRET_KEY:-change-me-in-production}
      - FLASK_ENV=${FLASK_ENV:-production}
    
    # 推荐：使用 .env 文件（确保 .env 文件存在且包含所有必需的密钥）
    env_file:
      - .env
    
    restart: unless-stopped
    
    healthcheck:
      test: ["CMD", "python", "-c", "import requests; requests.get('http://localhost:8080/', timeout=5)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
